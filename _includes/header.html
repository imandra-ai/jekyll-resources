<header class="header">
  <div class="top-row-container">
    <div class="top-row">
      <div 
        id="toggler--left" 
        class="side__left-menu-toggler" 
        onclick="toggleNavigation()"
      >
        <div class="side__toggle">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <p class="side__toggle-text">Docs</p>
      </div>

      <div class="side__logo-container">
        <a class="side__logo-link" href="{{ site.url }}">
          <img
            class="side__logo"
            src="{{ site.baseurl }}/jekyll-resources/assets/img/imandra-gradient-logo-docs.svg"
            alt="Imandra Logo"
          />
          <img
            class="side__logo--min"
            src="{{ site.baseurl }}/jekyll-resources/assets/img/imandra-gradient-logo-min.svg"
            alt="Imandra Logo"
          />
        </a>
      </div>

      <div id="flex-space-helper"></div>

        <nav class="side__nav-container side__nav-container--hidden">
            <ul class="side__nav-list" id="side-nav-menu">
                {% assign collections = (site.collections | sort: 'sequence') %}
                {% for mainsite in site.data.sites %}
                <li class="side__nav-list-item">
                    {% if site.baseurl == mainsite.baseurl %}
                    <a class="side__nav-link side__nav-link--active" href="{{ mainsite.baseurl }}">{{ mainsite.name
                        }}</a>
                    <ul class="side__nav-list--sub-level-1">
                        {% for collection in collections %}
                        {% if collection.label != 'posts' %}
                        {% assign colName = collection.label %}
                        {% assign col = site[colName] | sort: 'sequence' | shift %}
                        {% assign topPage = site[colName] | sort: 'sequence' | first %}
                        {% if page.collection == topPage.collection %}
                        {% if topPage.layout=="pageSbar" and col.size ==1 %}
                        <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty"><a class="side__nav-link side__nav-link--active" href="{{ topPage.url | prepend: site.baseurl }}">{{ topPage.title | markdownify | strip_html}}</a>
                            {% else %}
                            {% if col.size ==0 %}
                        <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty"><a class="side__nav-link side__nav-link--active" href="{{ topPage.url | prepend: site.baseurl }}">{{ topPage.title | markdownify | strip_html}}</a>
                            {% else %}
                        <li class="side__nav-list-item--sub-level-1"><a class="side__nav-link side__nav-link--active" href="{{ topPage.url | prepend: site.baseurl }}">{{ topPage.title | markdownify | strip_html}}</a>
                            {% endif %}
                            {% endif %}
                            <ul class="side__nav-list--sub-level-2 side__nav-list--sub-level-2--active">
                                {% else %}
                                {% if topPage.layout=="pageSbar" and col.size ==1 %}
                                <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty"><a class="side__nav-link" href="{{ topPage.url | prepend: site.baseurl }}">{{
                                topPage.title }}</a>
                                    {% else %}
                                    {% if col.size ==0 %}
                                <li class="side__nav-list-item--sub-level-1 side__nav-list--sub-level-1--empty"><a class="side__nav-link" href="{{ topPage.url | prepend: site.baseurl }}">{{
                        topPage.title }}</a>
                                    {% else %}
                                <li class="side__nav-list-item--sub-level-1"><a class="side__nav-link" href="{{ topPage.url | prepend: site.baseurl }}">{{
                        topPage.title }}</a>
                                    {% endif %}
                                    {% endif %}
                                    <ul class="side__nav-list--sub-level-2">
                                        {% endif %}
                                        {% for lin in col %}
                                        {% if topPage.layout == "pageSbar" %}
                                        {% if forloop.index == 1 %}
                                        {% else %}
                                        {% assign newLin = lin.tag | prepend: "#" | prepend: topPage.permalink %}
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty"><a class="side__nav-link--within-page" href="{{ newLin | prepend: site.baseurl }}">{{lin.title | markdownify | strip_html}}</a></li>
                                            {% endif %}
                                            {% else %}
                                            {% if page == lin %}
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty"><a class="side__nav-link side__nav-link--active side__nav-link--empty" href="{{ lin.url | prepend: site.baseurl }}">{{lin.title | markdownify | strip_html}}</a></li>
                                            {% else %}
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty"><a class="side__nav-link side__nav-link--empty" href="{{ lin.url | prepend: site.baseurl }}">{{lin.title | markdownify | strip_html}}</a></li>
                                            {% endif %}
                                            {% endif %}

                                        {% endfor %}
                                        {% if colName == "docTopic" and site.baseurl == "/fix-engine" %}
                                        <li class="side__nav-list-item--sub-level-2 side__nav-list--sub-level-2--empty"><a class="side__nav-link--within-page" href="{{ site.baseurl }}/_pages/doc/index.html" target="_blank">Technical Documentation</a></li>
                                        {% else %}
                                        {% endif %}
                                    </ul>
                                </li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                        </li>
                        {% else %}
                        <a class="side__nav-link" href="{{ mainsite.baseurl }}">{{ mainsite.name }}</a>
                </li>
                {% endif %}
                {% endfor %}
            </ul>
        </nav>
    </div>
  </div>

  <div class="template-header">
    <div class="top-bar">
      <nav class="top-bar__nav-container" id="top-menu">
        <div class="page-header-nav-container">
          <div class="side__nav-search">
            <div class="side__nav-search-icon">
              <i class="fa fa-search"></i>
            </div>
            <input id="search" type="search" placeholder="Search" />
          </div>
        </div>
      </nav>
    </div>
  </div>

  <script>
    function toggleNavigation() {
      // Toggle the hamburger menu animation
      const toggleButton = document.querySelector(
        ".side__left-menu-toggler .side__toggle"
      );
      if (toggleButton) {
        toggleButton.classList.toggle("side__toggle--active");
      }

      // Toggle the navigation visibility
      const navContainer = document.querySelector(".side__nav-container");
      if (navContainer) {
        navContainer.classList.toggle("side__nav-container--hidden");
      }
    }
  </script>

  <script>
    window.onload = function () {
      var lastId,
        sideMenu = $("#side-nav-menu"),
        topMenu = $("#top-menu");
      var topMenuHeight = topMenu.outerHeight() + 15,
        // All list items
        menuItems = sideMenu.find(
          'a[href^="{{page.permalink| prepend: site.baseurl}}#"]'
        ),
        // Anchors corresponding to menu items
        scrollItems = menuItems.map(function () {
          var item = $(this).attr("href");
          var thisItem = item.substring(item.lastIndexOf("/") + 1, item.length);
          var linkedItem = $(thisItem);
          if (linkedItem.length) {
            return linkedItem;
          }
        });

      // Bind to scroll
      $(window).scroll(function () {
        // Get container scroll position
        var fromTop = $(this).scrollTop() + topMenuHeight;

        // Get id of current scroll item
        var cur = scrollItems.map(function () {
          if ($(this).offset().top < fromTop) return this;
        });
        cur = cur[cur.length - 1];

        // Get the id of the current element

        var id = cur && cur.length ? cur[0].id : "";

        if (lastId != id) {
          // Set/remove active class
          if (lastId != null) {
            thisMenuItem = menuItems.filter(
              'a[href^="{{page.permalink| prepend: site.baseurl}}#' +
                lastId +
                '"]'
            );
            $(thisMenuItem).removeClass("side__nav-link--within-page--active");
          }
          lastId = id;
          if (id != "")
            menuItems
              .filter(
                'a[href^="{{page.permalink| prepend: site.baseurl}}#' +
                  id +
                  '"]'
              )
              .addClass("side__nav-link--within-page--active");
        }
      });
    };
  </script>
</header>
